<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BookLens - Book Scanner</title>
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
<div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                        <line x1="12" y1="6" x2="12" y2="10"></line>
                        <line x1="12" y1="14" x2="12" y2="18"></line>
                    </svg>
                </div>
                <span>BookLens</span>
            </div>
        </div>
        <a href="#scan" class="sidebar-item active" data-page="scan">
            <div class="sidebar-icon">üì∑</div>
            <span>Scan</span>
        </a>
        <a href="#search" class="sidebar-item" data-page="search">
            <div class="sidebar-icon">üîç</div>
            <span>Search</span>
        </a>
        <a href="#history" class="sidebar-item" data-page="history">
            <div class="sidebar-icon">üïê</div>
            <span>History</span>
        </a>
        
        <!-- Database Status Indicator -->
        <div style="margin-top: auto; padding: 24px; color: var(--sidebar-text-dim); font-size: 12px;">
            <div id="statusContent">Checking database...</div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <div class="page-title" id="pageTitle">Book Scanner</div>
        </div>

        <!-- Scan Page -->
        <div id="scanPage" class="content">
            <!-- Left: Upload (60%) -->
            <div class="section">
                <div class="section-title">
                    <span class="section-icon">üì∑</span>
                    Scan Book
                </div>
                <div class="upload-container">
                    <div class="camera-area" id="cameraArea">
                        <!-- Functional Elements -->
                        <video id="video" autoplay playsinline class="hidden"></video>
                        <canvas id="canvas" class="hidden"></canvas>
                        <img id="previewImage" class="hidden" alt="Preview">
                        
                        <!-- Overlay UI -->
                        <div class="camera-overlay" id="cameraOverlay">
                            <div class="camera-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                                    <circle cx="12" cy="13" r="4"></circle>
                                </svg>
                            </div>
                            <div class="camera-text" id="cameraText">Open Camera</div>
                            <div class="camera-subtext">or click Upload Image below</div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons - Fixed Layout -->
                    <div class="action-buttons-container">
                        <input type="file" id="fileInput" accept="image/*" class="hidden">

                        <!-- Primary Row: Camera Actions (Grid Layout) -->
                        <div class="camera-actions-row">
                            <button class="capture-btn hidden" id="captureBtn">‚óè Capture</button>
                            <button class="recapture-btn hidden" id="recaptureBtn">‚Ü∫ Re-capture</button>
                            <button class="scan-btn hidden" id="scanBtn">‚ö° Process Scan</button>
                        </div>
                        
                        <!-- Secondary Row: Upload (Always Visible) -->
                        <div class="upload-action-row">
                             <button class="upload-btn" id="uploadBtn">‚Üë Upload Image</button>
                        </div>
                    </div>
                    
                    <div id="statusMessage" style="text-align: center; color: var(--text-medium); font-size: 13px;"></div>
                </div>

                <!-- Alternative Matches -->
                <div class="recent-searches">
                    <div class="recent-title">
                        Alternative Matches
                        <span style="font-size: 12px; font-weight: normal; color: var(--text-light)">(Low Confidence)</span>
                    </div>
                    <div id="alternativesContainer">
                        <div style="color: var(--text-light); text-align: center; padding: 20px;">
                            Scan a book to see potential matches here.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Main Results (40%) -->
            <div class="section">
                <div class="section-header">
                    <div class="section-title">
                        <span class="section-icon">üèÜ</span>
                        Top Result
                    </div>
                    <button class="clear-all-btn" onclick="clearAllResults()">Clear</button>
                </div>
                <div class="results-container" id="resultsContainer">
                    <div class="empty-state" style="padding: 40px 0;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üìö</div>
                        <div class="empty-state-text">No Results</div>
                        <div class="empty-state-subtext">Scan a book cover to see details</div>
                    </div>
                </div>
                
                <!-- OCR Debug Text (Optional) -->
                <div id="extractedText" style="display:none; margin-top: 20px; padding: 15px; background: var(--bg-tertiary); border-radius: 10px; font-size: 12px; color: var(--text-medium);">
                </div>
            </div>
        </div>

        <!-- Search Page -->
        <div id="searchPage" class="page-content" style="display: none;">
            <div class="search-page-container">
                <div class="search-page-header">
                    <div class="search-page-title">Search Books</div>
                    <div class="search-page-subtitle">Find books by title, author, ISBN, or publisher</div>
                </div>
                <div class="search-box-large">
                    <span class="search-icon">üîç</span>
                    <input type="text" id="manualSearchInput" placeholder="Enter book title, author, ISBN...">
                </div>
                <div id="manualSearchResults" class="results-container">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìö</div>
                        <div class="empty-state-text">Start searching</div>
                        <div class="empty-state-subtext">Enter a search term above to find books</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Page -->
        <div id="historyPage" class="page-content" style="display: none;">
            <div class="history-container">
                <div class="history-header">
                    <div class="history-title">Scan History</div>
                    <button class="history-clear-btn" onclick="clearHistory()">Clear All</button>
                </div>
                <div id="historyList" class="history-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üìñ</div>
                        <div class="empty-state-text">No history yet</div>
                        <div class="empty-state-subtext">Your scanned books will appear here</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay">
    <div class="spinner"></div>
    <h3 id="loadingText">Processing Image...</h3>
</div>

<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
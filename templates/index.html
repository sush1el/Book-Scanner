<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BookLens - Book Scanner</title>
<style>
    /* ... existing global styles ... */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
        --bg-primary: #FAFAFA;
        --bg-secondary: #FFFFFF;
        --bg-tertiary: #F5F5F5;
        --accent-blue: #3B82F6;
        --accent-blue-hover: #2563EB;
        --accent-blue-light: #DBEAFE;
        --accent-purple: #8B5CF6;
        --accent-green: #10B981;
        --accent-orange: #F59E0B;
        --border-color: #E5E7EB;
        --text-dark: #111827;
        --text-medium: #6B7280;
        --text-light: #9CA3AF;
        --shadow-sm: rgba(0, 0, 0, 0.05);
        --shadow-md: rgba(0, 0, 0, 0.1);
        --shadow-lg: rgba(59, 130, 246, 0.15);
        --sidebar-bg: #1c2e4a;
        --sidebar-text: #ffffff;
        --sidebar-text-dim: #a8b8d8;
    }
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--bg-primary);
        color: var(--text-dark);
    }
    .container { display: flex; height: 100vh; overflow: hidden; }
    
    /* Sidebar */
    .sidebar { 
        width: 280px; 
        background: var(--sidebar-bg);
        border-right: 1px solid rgba(255, 255, 255, 0.1);
        padding: 32px 0; 
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
    }
    .sidebar-header {
        padding: 0 24px 32px 24px;
        margin-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .logo { 
        font-size: 28px; 
        font-weight: 800; 
        letter-spacing: -1px; 
        color: var(--sidebar-text);
        display: flex;
        align-items: center;
        gap: 12px;
    }
    .logo-icon {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--accent-blue);
        border-radius: 10px;
        transform: rotate(-5deg);
        transition: transform 0.3s ease;
    }
    .logo-icon:hover {
        transform: rotate(0deg) scale(1.1);
    }
    .logo-icon svg {
        width: 22px;
        height: 22px;
        fill: none;
        stroke: white;
        stroke-width: 2.5;
        stroke-linecap: round;
        stroke-linejoin: round;
    }
    .sidebar-item { 
        display: flex; 
        align-items: center; 
        padding: 16px 24px; 
        margin: 4px 16px; 
        border-radius: 14px; 
        cursor: pointer; 
        transition: all 0.3s ease; 
        font-size: 15px; 
        font-weight: 600;
        color: var(--sidebar-text-dim); 
        background: transparent;
        position: relative;
        text-decoration: none;
    }
    .sidebar-item:hover { 
        background: rgba(255, 255, 255, 0.1); 
        color: var(--sidebar-text);
        transform: translateX(4px);
    }
    .sidebar-item.active { 
        background: var(--accent-blue);
        color: white; 
        font-weight: 700;
        box-shadow: 0 4px 12px var(--shadow-lg);
        transform: translateX(0);
    }
    .sidebar-item.active:hover {
        transform: translateX(0) scale(1.02);
    }
    .sidebar-icon { 
        width: 24px; 
        height: 24px; 
        margin-right: 14px; 
        display: flex; 
        align-items: center; 
        justify-content: center;
        font-size: 20px;
    }
    
    /* Main content */
    .main-content { 
        flex: 1; 
        display: flex; 
        flex-direction: column; 
        overflow: hidden; 
        background: var(--bg-primary);
    }
    .header { 
        background: var(--bg-secondary);
        padding: 24px 48px; 
        border-bottom: 1px solid var(--border-color); 
        display: flex; 
        justify-content: space-between; 
        align-items: center;
        box-shadow: 0 1px 3px var(--shadow-sm);
    }
    .search-bar { position: relative; width: 100%; max-width: 500px; }
    .search-bar input { 
        width: 100%; 
        padding: 14px 20px 14px 52px; 
        border: 2px solid var(--border-color); 
        border-radius: 14px; 
        font-size: 15px; 
        font-weight: 500;
        background-color: var(--bg-tertiary); 
        color: var(--text-dark);
        transition: all 0.3s ease;
    }
    .search-bar input:focus { 
        outline: none; 
        border-color: var(--accent-blue); 
        background-color: var(--bg-secondary);
        box-shadow: 0 0 0 4px var(--accent-blue-light);
    }
    .search-bar input::placeholder {
        color: var(--text-light);
        font-weight: 500;
    }
    .search-icon { 
        position: absolute; 
        left: 20px; 
        top: 50%; 
        transform: translateY(-50%); 
        font-size: 20px;
        color: var(--accent-blue);
        font-weight: bold;
    }
    .page-title {
        font-size: 13px;
        font-weight: 800;
        color: var(--text-medium);
        text-transform: uppercase;
        letter-spacing: 2px;
    }
    
    .content { 
        flex: 1; 
        overflow-y: auto; 
        padding: 48px; 
        display: grid; 
        grid-template-columns: 60% 40%; 
        gap: 32px; 
        height: 100%; /* Ensure content fills height */
    }
    
    .section { 
        display: flex; 
        flex-direction: column; 
        gap: 24px; 
        height: 100%;
        min-height: 0; /* Important for scrolling */
    }
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
    }
    .section-title { 
        font-size: 22px; 
        font-weight: 800; 
        display: flex; 
        align-items: center; 
        gap: 12px;
        color: var(--text-dark);
        letter-spacing: -0.5px;
        flex-shrink: 0;
    }
    .section-icon {
        font-size: 28px;
        color: var(--accent-blue);
    }
    .clear-all-btn {
        padding: 10px 20px;
        background: var(--bg-secondary);
        border: 2px solid var(--border-color);
        border-radius: 10px;
        color: var(--text-dark);
        font-size: 13px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .clear-all-btn:hover {
        background: var(--accent-blue);
        color: white;
        border-color: var(--accent-blue);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px var(--shadow-lg);
    }
    
    /* MODIFIED: Flexible Upload Container */
    .upload-container {
        background: var(--bg-secondary);
        border-radius: 24px;
        padding: 24px; /* Reduced padding for more screen space */
        border: 2px solid var(--border-color);
        display: flex;
        flex-direction: column;
        gap: 20px;
        box-shadow: 0 4px 6px var(--shadow-sm);
        transition: all 0.3s ease;
        flex: 1; /* Grow to fill available space */
        min-height: 0; /* Allow shrinking */
    }
    
    .camera-area {
        background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
        border-radius: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
        flex: 1; /* Fill all remaining vertical space */
        width: 100%;
        min-height: 300px; /* Minimum height constraint */
    }
    
    /* Video and Canvas Styles */
    #video, #canvas, #previewImage {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Fill the area */
        position: absolute;
        top: 0;
        left: 0;
    }
    
    .camera-overlay {
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10;
        pointer-events: none;
    }
    
    .camera-area:hover .camera-overlay .camera-icon {
        transform: scale(1.1) rotate(5deg);
    }

    .camera-icon {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.25);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        margin-bottom: 1rem;
    }
    
    .camera-icon svg {
        width: 40px;
        height: 40px;
        fill: none;
        stroke: white;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
    }
    .camera-text {
        font-size: 24px;
        font-weight: 800;
        color: white;
        letter-spacing: -0.5px;
    }
    .camera-subtext {
        font-size: 15px;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.9);
    }
    
    /* NEW: Action Buttons Container */
    .action-buttons-container {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: auto;
    }
    
    .camera-actions-row {
        display: flex;
        gap: 12px;
        min-height: 0; /* Allows collapsing if children hidden */
    }
    /* Only show row if it has active buttons */
    .camera-actions-row:empty { display: none; }

    .upload-action-row {
        display: flex;
    }

    /* Common Button Styles */
    .upload-btn, .scan-btn, .capture-btn, .recapture-btn {
        padding: 0 24px;
        height: 56px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, var(--accent-green) 0%, #06b6d4 100%);
        color: white;
        border: none;
        border-radius: 14px;
        font-size: 16px;
        font-weight: 800;
        cursor: pointer;
        transition: all 0.3s ease;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        flex: 1;
        white-space: nowrap;
    }
    
    .capture-btn {
        background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    .recapture-btn {
        background: white;
        color: var(--text-medium);
        border: 2px solid var(--border-color);
        box-shadow: none;
    }
    .recapture-btn:hover {
        background: var(--bg-tertiary);
        color: var(--text-dark);
        transform: translateY(-2px);
    }
    
    .scan-btn {
        background: linear-gradient(135deg, var(--accent-orange) 0%, #ef4444 100%);
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }
    
    /* Secondary Style for Upload Button */
    .upload-btn {
        background: white;
        color: var(--text-dark);
        border: 2px solid var(--border-color);
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .upload-btn:hover {
        background: var(--bg-tertiary);
        border-color: var(--accent-blue);
        transform: translateY(-2px);
    }
    
    /* Results Styles */
    .results-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
        overflow-y: auto;
        padding-right: 8px;
        flex: 1; /* Fill remaining height */
    }
    
    .result-card {
        background: var(--bg-secondary);
        border: 2px solid var(--border-color);
        border-radius: 20px;
        padding: 24px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px var(--shadow-sm);
    }
    .result-card.highlight {
        border-color: var(--accent-blue);
        box-shadow: 0 8px 20px var(--shadow-lg);
        background: #f0f9ff;
    }
    
    .result-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--bg-tertiary);
    }
    .book-title {
        font-size: 20px;
        font-weight: 800;
        color: var(--text-dark);
        letter-spacing: -0.5px;
    }
    .result-details { display: flex; flex-direction: column; gap: 12px; }
    
    .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background: var(--bg-tertiary);
        border-radius: 10px;
    }
    .detail-label {
        font-size: 12px;
        font-weight: 700;
        color: var(--text-medium);
        text-transform: uppercase;
    }
    .detail-value { font-size: 15px; font-weight: 600; color: var(--text-dark); }
    
    /* Alternative/Recent Scans Area */
    .recent-searches {
        background: var(--bg-secondary);
        border: 2px solid var(--border-color);
        border-radius: 20px;
        padding: 24px;
        box-shadow: 0 2px 8px var(--shadow-sm);
        height: 200px; /* Fixed height for alternatives */
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
    }
    .recent-title {
        font-size: 16px;
        font-weight: 800;
        color: var(--text-dark);
        margin-bottom: 16px;
        text-transform: uppercase;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    #alternativesContainer {
        overflow-y: auto;
        flex: 1;
        padding-right: 5px;
    }

    .recent-item {
        padding: 14px 18px;
        margin-bottom: 10px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 600;
        color: var(--text-dark);
        cursor: pointer;
        transition: all 0.3s ease;
        background: var(--bg-tertiary);
        border-left: 3px solid transparent;
        display: flex;
        justify-content: space-between;
    }
    .recent-item:hover { 
        background: var(--accent-blue);
        color: white;
        transform: translateX(8px);
        border-left-color: var(--accent-orange);
    }
    .confidence-badge {
        font-size: 11px;
        background: rgba(0,0,0,0.1);
        padding: 2px 6px;
        border-radius: 4px;
    }

    /* Page-specific styles */
    .search-page-container { max-width: 800px; margin: 0 auto; }
    .search-page-header { text-align: center; margin-bottom: 48px; }
    .search-page-title { font-size: 42px; font-weight: 900; color: var(--text-dark); margin-bottom: 16px; }
    .search-page-subtitle { font-size: 18px; color: var(--text-medium); font-weight: 500; }
    .search-box-large { position: relative; margin-bottom: 32px; }
    .search-box-large input {
        width: 100%; padding: 24px 28px 24px 64px;
        border: 3px solid var(--border-color); border-radius: 20px;
        font-size: 18px; font-weight: 600;
        background-color: var(--bg-secondary); color: var(--text-dark);
        transition: all 0.3s ease; box-shadow: 0 4px 12px var(--shadow-sm);
    }
    .search-box-large input:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 8px 24px var(--shadow-lg); }
    .search-box-large .search-icon { left: 28px; font-size: 24px; }
    
    .empty-state { text-align: center; padding: 80px 32px; color: var(--text-medium); }
    .empty-state-icon { font-size: 64px; margin-bottom: 24px; opacity: 0.5; }
    
    /* Loading overlay */
    #loadingOverlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(255,255,255,0.9); z-index: 1000;
        display: none; justify-content: center; align-items: center; flex-direction: column;
    }
    .spinner {
        width: 50px; height: 50px;
        border: 5px solid var(--accent-blue-light);
        border-top: 5px solid var(--accent-blue);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    /* Hidden elements */
    .hidden { display: none !important; }
</style>
</head>
<body>
<div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                        <line x1="12" y1="6" x2="12" y2="10"></line>
                        <line x1="12" y1="14" x2="12" y2="18"></line>
                    </svg>
                </div>
                BookLens
            </div>
        </div>
        <a href="#scan" class="sidebar-item active" data-page="scan">
            <div class="sidebar-icon">‚åÇ</div>
            <span>Scan</span>
        </a>
        <a href="#search" class="sidebar-item" data-page="search">
            <div class="sidebar-icon">‚äô</div>
            <span>Search</span>
        </a>
        <a href="#history" class="sidebar-item" data-page="history">
            <div class="sidebar-icon">‚ü≤</div>
            <span>History</span>
        </a>
        
        <!-- Database Status Indicator -->
        <div style="margin-top: auto; padding: 24px; color: var(--sidebar-text-dim); font-size: 12px;">
            <div id="statusContent">Checking database...</div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <div class="page-title" id="pageTitle">Book Scanner</div>
        </div>

        <!-- Scan Page -->
        <div id="scanPage" class="content">
            <!-- Left: Upload (60%) -->
            <div class="section">
                <div class="section-title">
                    <span class="section-icon">üì∑</span>
                    Scan Book
                </div>
                <div class="upload-container">
                    <div class="camera-area" id="cameraArea">
                        <!-- Functional Elements -->
                        <video id="video" autoplay playsinline class="hidden"></video>
                        <canvas id="canvas" class="hidden"></canvas>
                        <img id="previewImage" class="hidden" alt="Preview">
                        
                        <!-- Overlay UI -->
                        <div class="camera-overlay" id="cameraOverlay">
                            <div class="camera-icon">
                                <svg viewBox="0 0 24 24">
                                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                                    <circle cx="12" cy="13" r="4"></circle>
                                </svg>
                            </div>
                            <div class="camera-text" id="cameraText">Open Camera</div>
                            <div class="camera-subtext">or click Upload Image below</div>
                        </div>
                    </div>
                    
                    <!-- NEW: Stacked Action Buttons -->
                    <div class="action-buttons-container">
                        <input type="file" id="fileInput" accept="image/*" class="hidden">

                        <!-- Primary Row: Camera Actions -->
                        <div class="camera-actions-row">
                            <button class="capture-btn hidden" id="captureBtn">‚óâ Capture</button>
                            <button class="recapture-btn hidden" id="recaptureBtn">‚Ü∫ Re-capture</button>
                            <button class="scan-btn hidden" id="scanBtn">‚ö° Process Scan</button>
                        </div>
                        
                        <!-- Secondary Row: Upload (Always Visible) -->
                        <div class="upload-action-row">
                             <button class="upload-btn" id="uploadBtn">‚Üë Upload Image</button>
                        </div>
                    </div>
                    
                    <div id="statusMessage" style="text-align: center; color: var(--text-medium); font-size: 13px;"></div>
                </div>

                <!-- GREEN BOX: Alternatives -->
                <div class="recent-searches">
                    <div class="recent-title">
                        Alternative Matches
                        <span style="font-size: 12px; font-weight: normal; color: var(--text-light)">(Low Confidence)</span>
                    </div>
                    <div id="alternativesContainer">
                        <div style="color: var(--text-light); text-align: center; padding: 20px;">
                            Scan a book to see potential matches here.
                        </div>
                    </div>
                </div>
            </div>

            <!-- RED BOX: Main Results (40%) -->
            <div class="section">
                <div class="section-header">
                    <div class="section-title">
                        <span class="section-icon">üèÜ</span>
                        Top Result
                    </div>
                    <button class="clear-all-btn" onclick="clearAllResults()">Clear</button>
                </div>
                <!-- ID used for main result -->
                <div class="results-container" id="resultsContainer">
                    <div class="empty-state" style="padding: 40px 0;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üìö</div>
                        <div class="empty-state-text">No Results</div>
                        <div class="empty-state-subtext">Scan a book cover to see details</div>
                    </div>
                </div>
                
                <!-- OCR Debug Text (Optional) -->
                <div id="extractedText" style="display:none; margin-top: 20px; padding: 15px; background: var(--bg-tertiary); border-radius: 10px; font-size: 12px; color: var(--text-medium);">
                </div>
            </div>
        </div>

        <!-- Search Page -->
        <div id="searchPage" class="page-content" style="display: none;">
            <div class="search-page-container">
                <div class="search-page-header">
                    <div class="search-page-title">Search Books</div>
                    <div class="search-page-subtitle">Find books by title, author, ISBN, or publisher</div>
                </div>
                <div class="search-box-large">
                    <span class="search-icon">‚äô</span>
                    <input type="text" id="manualSearchInput" placeholder="Enter book title, author, ISBN...">
                </div>
                <div id="manualSearchResults" class="results-container">
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <div class="empty-state-text">Start searching</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Page -->
        <div id="historyPage" class="page-content" style="display: none;">
            <div class="history-container">
                <div class="history-header">
                    <div class="history-title">Scan History</div>
                </div>
                <div id="historyList" class="history-list">
                    <div class="empty-state">
                        <div class="empty-state-text">No history yet</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay">
    <div class="spinner"></div>
    <h3 id="loadingText">Processing Image...</h3>
</div>

<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>